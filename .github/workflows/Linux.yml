name: Linux CI


on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]


jobs:

  build:

    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2

      - name: before install
        run: |
          sudo apt-get update
          sudo apt-get install -y yasm
          sudo apt-get install -y libsdl2-dev
          sudo apt-get install -y clang-format
          sudo apt-get install git make gcc autoconf libtool yasm cmake g++ libsdl2-dev
          wget "https://github.com/Kitware/CMake/releases/download/v3.16.2/cmake-3.16.2-Linux-x86_64.tar.gz"
          tar zxf cmake-3.16.2-Linux-x86_64.tar.gz
          export PATH=`pwd`/cmake-3.16.2-Linux-x86_64/bin:$PATH
          sudo apt-get install clang llvm
          echo  1 | sudo update-alternatives --config cc

      - name: build_external
        run: |
          git config --global user.email "you@example.com"
          git config --global user.name "Your Name"
          . setup.env
          cd external/
          ./build_external.sh Linux
          cd ..

      - name: build_cmdline
        run: |
          cd cmdline/
          mkdir build
          cd build
          cmake ../
          make cicadaPlayer
